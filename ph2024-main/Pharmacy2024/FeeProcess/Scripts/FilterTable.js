/************************************************************************************************
Name		- Filter Table
Description	- Makes tables filtering enabled.
Version		- 1.0.0
Author		- Anoop Nair.
Company		- OASIS (part of MKCL).

# COPYRIGHT NOTICE
# Copyright (c) 2005-2009 MKCL, All rights reserved.
# This script may be used and modified free of charge for Non-profit purposes by anyone as long
# as this copyright notice and the comments above are kept in their original form.
************************************************************************************************/

 FilterTable_tables=new Array();FilterTable_tables[0]=new Array();FilterTable_tables[1]=new Array();FilterTable_tables[2]=new Array();FilterTable_tables[3]=new Array();FilterTable_tables[4]=new Array();FilterTable_tables[5]=new Array();function FilterTable_Initialize(){var i=0,count=0;var tables=document.getElementsByTagName("TABLE");for(var i=0;i< tables.length;i++)if(tables[i].getAttribute('filtertable'))FilterTable_AddFilters(tables.item(i),count++);}function FilterTable_AddFilters(tabFilt,index){FilterTable_tables[index][0]=tabFilt;var attribs=tabFilt.getAttribute('filtertable').split(';');var endPos=0,startPos=-1,i=0,j=0;var filterColumns=new Array(),colsTemp1=new Array(),colsTemp2=new Array();if(attribs[attribs.length-1].trim()=="")attribs.length--;for(i=0;i<attribs.length;i++){if(attribs[i].split(':')[0]=="footer-rows"){if(IsNumber(attribs[i].split(':')[1]))endPos=parseInt(attribs[i].split(':')[1]);}else if(attribs[i].split(':')[0]=="header-rows"){if(IsNumber(attribs[i].split(':')[1]))startPos=parseInt(attribs[i].split(':')[1]);}else if(attribs[i].split(':')[0]=="filter-columns-text"){colsTemp1=attribs[i].split(':')[1].split(',');}else if(attribs[i].split(':')[0]=="filter-columns-select"){colsTemp2=attribs[i].split(':')[1].split(',');}}endPos=tabFilt.rows.length-endPos;if(startPos==-1)for(i=0;i<tabFilt.rows[0].cells.length;i++)if(startPos< tabFilt.rows[0].cells[i].rowSpan)startPos=tabFilt.rows[0].cells[i].rowSpan;filterColumns.length=tabFilt.rows[startPos].cells.length;var init=(colsTemp1.length==0 && colsTemp2.length==0)? 1:0;for(j=0;j<filterColumns.length;j++)filterColumns[j]=init;for(j=0;j<colsTemp1.length;j++)if(IsNumber(colsTemp1[j])&& parseInt(colsTemp1[j])<filterColumns.length)filterColumns[parseInt(colsTemp1[j])]=1;for(j=0;j<colsTemp2.length;j++)if(IsNumber(colsTemp2[j])&& parseInt(colsTemp2[j])<filterColumns.length)filterColumns[parseInt(colsTemp2[j])]=2;colsTemp1=null;colsTemp2=null;var newRow=tabFilt.insertRow(startPos);newRow.id="FilterTableRow"+index;var k=0;for(i=0;i<tabFilt.rows[startPos+1].cells.length;i++){var newCell=newRow.insertCell(-1);if(tabFilt.rows[startPos+1].cells[i].style.display=="none")newCell.style.display="none";if(filterColumns[i]==2){var newSelect=document.createElement("select");k=0;newSelect[k++]=new Option("--All--","");newSelect.selectedIndex=0;for(j=startPos+1;j<=endPos;j++)k=AddNewOption(newSelect,GetInnerText(tabFilt.rows[j].cells[i]),k);newSelect.style.width=(parseInt(tabFilt.rows[startPos+1].cells[i].offsetWidth)-11)+"px";newCell.appendChild(newSelect);SetAttribute(newSelect,"onchange","FilterTable_FilterData("+index+","+i+",this.value.toLowerCase())");}else if(filterColumns[i]==1){var newInput=document.createElement("input");newInput.type="text";newInput.style.width=(parseInt(tabFilt.rows[startPos+1].cells[i].offsetWidth)-11)+"px";newCell.appendChild(newInput);newInput.setAttribute("onkeydown","FilterTable_SetFilter("+index+",this.value.length)");SetAttribute(newInput,"onkeyup","FilterTable_FilterData("+index+","+i+",this.value.toLowerCase())");}else{newCell.appendChild(document.createTextNode(" "));}}FilterTable_tables[index][1]=startPos+1;FilterTable_tables[index][2]=endPos;FilterTable_tables[index][3]=-1;FilterTable_tables[index][4]=filterColumns;FilterTable_tables[index][5]=new Array();for(i=0;i<filterColumns.length;i++)FilterTable_tables[index][5][i]="";}function AddNewOption(selectBox,newValue,curIndex){var i=0;for(;i< selectBox.options.length;i++)if(newValue==selectBox.options[i].value)break;if(i==selectBox.options.length)selectBox[curIndex++]=new Option(newValue,newValue);return curIndex;}function FilterTable_SetFilter(tableIndex,matchLength){FilterTable_tables[tableIndex][3]=matchLength;}function FilterTable_FilterData(tableIndex,columnNumber,matchRecord){var grid=FilterTable_tables[tableIndex][0];var startPos=FilterTable_tables[tableIndex][1];var endPos=FilterTable_tables[tableIndex][2];var curLen=matchRecord.length;var i=0,j=0;FilterTable_tables[tableIndex][5][columnNumber]=matchRecord;var matchData=FilterTable_tables[tableIndex][5];if(matchRecord=="")for(i=startPos;i<=endPos;i++){grid.rows[i].style.display=(FilterTable_MatchRow(tableIndex,columnNumber,grid.rows[i],matchData)? '': 'none');}else if(FilterTable_tables[tableIndex][4][columnNumber]==2)for(i=startPos;i<=endPos;i++){grid.rows[i].style.display=(GetInnerText(grid.rows[i].cells[columnNumber]).toLowerCase()==matchRecord?(FilterTable_MatchRow(tableIndex,columnNumber,grid.rows[i],matchData)? '': 'none'): 'none');}else if(matchRecord.length< FilterTable_tables[tableIndex][3])for(i=startPos;i<=endPos;i++){if(grid.rows[i].style.display=='')continue;if(GetInnerText(grid.rows[i].cells[columnNumber]).substring(0,curLen).toLowerCase()==matchRecord && FilterTable_MatchRow(tableIndex,columnNumber,grid.rows[i],matchData))grid.rows[i].style.display='';}else for(i=startPos;i<=endPos;i++){if(grid.rows[i].style.display=='none')continue;if(GetInnerText(grid.rows[i].cells[columnNumber]).substring(0,curLen).toLowerCase()!=matchRecord)grid.rows[i].style.display='none';}}function FilterTable_MatchRow(tableIndex,colNumber,rowData,matchData){for(var i=0;i<rowData.cells.length;i++){if(i==colNumber || matchData[i]=="")continue;if(FilterTable_tables[tableIndex][4][i]==2 && GetInnerText(rowData.cells[i]).toLowerCase()!=matchData[i])return false;if(GetInnerText(rowData.cells[i]).substring(0,matchData[i].length).toLowerCase()!=matchData[i])return false;}return true;}addOnLoadEvent(FilterTable_Initialize);